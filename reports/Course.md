<!-- Adventures in Rule-Based Programming: A CLIPS Tutorial 
https://www.amazon.com/Adventures-Rule-Based-Programming-CLIPS-Tutorial/dp/B09ZCL2VMM
979-8985783902

dnf install clips 

-->
\setcounter{section}{-1}
\refstepcounter{section}
# Введение {-}

Экспертная система --- система поддержки принятия решений,
основанная на знаниях из
определённой предметной области.

Экспертная система заключает в себе представление знаний из определенной предметной области.
Такие системы широко используются для консультаций,
помощи в принятии сложных решений,
для решения неформализованных задач.

В данном отчёте представлена разработанная в ходе курсовой работы
экспертная система в среде CLIPS, выполняющая роль
интерактивного текстового квеста с выбором вариантов ответа.

# Постановка задачи

В курсовой работе требуется:

<!-- - выбрать предметную область (согласовать ее с преподавателем),
построить продукционную модель экспертной системы (например, поиска неисправности)
и согласовать ее с преподавателем. -->

1. Реализовать экспертную систему в среде CLIPS на основе продукционной
модели: текстовый квест по мотивам повести «Хоббит, или Туда и обратно» Дж. Р. Р. Толкина.

2. Реализовать пользовательский интерфейс с возможностью ввода ответов,
    представляющих выбор из нескольких вариантов.
и вывода результата работы на экран.

Формальные требования к ациклическому связному графу переходов:

- минимальная длина пути от начальной вершины до одной из конечных: 4 (перехода),
- минимальное число узлов --- 30.

# Предметная область

Предметной областью экспертной системы является множество вариантов развития сюжета в текстовом квесте.

Выбор этой предметной области обоснован личным интересом к интерактивной художественной литературе. Текстовый квесты и визуальные новеллы можно отнести к этой разновидности литературы.

С формальной точки зрения, текстовый квест состоит из текстовых _блоков_,
каждый из которых заканчивается выбором варианта либо реплики героя истории, либо его действия (бездействия).
Выбор того или иного варианта игроком (пользователем) определяет дальнейшее развитие сюжета.

С художественной точки зрения, текстовый квест представляет из себя интерактивную историю, то есть такую,
в которой читатель может повлиять на ход истории или предрешить ее концовку
(например, правильные выборы могут привести к счастливой концовке,
неправильные к плохой). Подобное решение позволяет сильнее вовлечь читателя,
в отличии от линейного повествования
в литературе классического формата[@Riley2022].

В качестве литературного источника была взята повесть «Хоббит, или Туда и обратно» английского писателя Дж. Р. Р. Толкина.
Герой истории --- хоббит Бильбо Беггинс, действие происходит в мире Средиземья.

На рис. \ref{fig:condense} представлена схема переходов, представляющая различные пути прохождения квеста.
Стрелками обозначены различные варианты выбора, узлами --- линейные участки истории.

![Схема переходов в сюжете квеста. Обозначения: красными прямоугольниками обозначены плохие концовки, зелеными --- счастливый конец. Желтыми овалами обозначены промежуточные элементы сюжета, приводящие к плохим концовкам.\label{fig:condense}](img/course/Хоббит.pdf)

# Математическое описание

## Экспертная система и их особенности

Для решения поставленной задачи была разработана экспертная система в среде
CLIPS.

*Экспертная система* --- это программа, которая
оперирует знаниями в определенной предметной области с целью выработки
рекомендаций или решения проблем.

Экспертные системы главным образом основаны на эвристическом поиске
решения, что является одним из главных преимуществ технологии экспертных
систем перед традиционным подходом к разработке программ[@vostrov].

*Задачи, решаемые экспертными системами:*

-   Извлечение информации из первичных данных;

-   Диагностика неисправностей;

-   Структурный анализ сложных объектов;

-   Выбор конфигурации сложных многокомпонентных систем;

-   Планирование последовательности выполнения операций, приводящих к
    заданной цели.[@jackson2001]

**Функции экспертных систем:**

-   Приобретение знаний;

-   Представление знаний в удобной для работы форме; процессом поиска
    решений. [@jackson2001]

*Экспертная система работает в двух основных режимах:*

1. в режиме приобретения знаний;

2. в режиме решения задачи[@vostrov].

## Основные компоненты экспертной системы

На Рис. \ref{fig:es struct} представлена обобщенная структура экспертной системы.

![Структура экспертной системы\label{fig:es struct}](img/course/es-struct-2.png)

-   *База данных* используется для хранения исходных и промежуточных
    данных решаемой задачи.

-   *База знаний* предназначена для хранения долгосрочных данных,
    которые описывают рассматриваемую предметную область. Кроме того,
    база знаний хранит правила, используемые для оперирования данными.
    Правила представляют собой типовые алгоритмы обработки данных,
    которые позволяют получить новые знания из имеющихся данных. Другими
    словами, база знаний --- набор таких закономерностей, которые
    устанавливают связи между вводимой и выводимой информацией. В
    формировании базы знаний участвуют эксперты, инженеры по знаниям,
    программисты.

-   *Эксперт*  --- человек, способный находить правильные решения проблем в
    конкретной предметной области. Эксперт использует свои приёмы, чтобы
    сделать поиск решения более эффективным. Экспертная система
    моделирует все его стратегии поиска решений.

    Задача эксперта состоит в определении данных и правил, которые
    достаточно полно характеризуют предметную область. Кроме того,
    эксперт обеспечивает полноту и правильность имеющейся базы знаний.

-   *Инженер знаний* --- человек, имеющий познания в информатике и
    искусственном интеллекте и знающий, как надо строить экспертную
    систему. Инженер знаний опрашивает экспертов, организует знания,
    решает, каким образом они должны быть представлены в экспертной системе, и может
    помочь программисту в написании программ. В задачи инженера знаний
    входит: обеспечение, структурирование знаний, выбор наиболее
    подходящего для решения поставленных задач программного средства.

-   *Программист* --- специалист в области разработки программного
    обеспечения. Реализует экспертную систему на практике. Задача
    программиста: разработка необходимых программных средств и
    осуществление сопряжения этих средств с программным окружением
    экспертной системы.

-   *Пользователь* --- человек, который использует экспертную систему.

    Термин пользователь неоднозначен.

    Пользователем также может быть:

    - создатель инструмента, отлаживающий средство построения экспертной системы;

    - инженер знаний, уточняющий существующие в экспертной системе знания;

    - эксперт, добавляющий в систему новые знания;

-   *Интерфейс пользователя* --- комплекс программ, реализующих диалог
    пользователя с экспертной системой как на стадии ввода информации, так и на стадии
    получения результатов.[@jackson2001].

## Характерные черты экспертной системы

Экспертная система обычно проектируется таким образом, чтобы она обладала
описанными ниже общими характеристиками.

- Высокая эффективность. Система должна обладать способностью давать
ответы на уровне компетентности, равной или более высокой по сравнению
с экспертом в данной области.
- Приемлемое время отклика. Система должна выполнять свою работу за
приемлемое время.
- Высокая надежность. Экспертная система должна быть надежной и не
    подверженной сбоям;
- Доступность для понимания;
- Гибкость. Важно иметь эффективный механизм добавления,
модификации и удаления знаний[@djarratano2007].

## Продукционная модель

Продукционная модель является моделью представления знаний, основанная
на правилах, позволяющая представить знания в виде предложений типа:

```plain
IF <условие>, THEN <действие>.
```

«Условие» (антецедент) --- некоторое предложение-образец, по которому
осуществляется поиск в базе знаний.

«Действие» (консеквент) --- действия, выполняемые при успешном исходе
поиска (они могут быть промежуточными, выступающими далее как условия и
терминальными или целевыми, завершающими работу системы)[@chast2001].

*Преимущества продукционной модели:*

-  простота создания и понимания отдельных правил;

-  простота механизма логического выбора.

*Недостатки продукционной модели:*

-  отличие от структур знаний, свойственных человеку;

-  неясность взаимных отношений правил;

-  сложность оценки целостного образа знаний;

-  низкая эффективность обработки знаний[@vostrov]. 

## Ориентированный ациклический граф решений

Экспертная система представлена ациклическим орграфом решений --- обобщением бинарного дерева решений с причинно-следственной связью.
Стартовым узлом является блок «Как-то тихим утром вы, плотно подзакусив и покуривая трубку...». В орграфе решений блоки --- это
узлы решения, а конечные результаты --- это конечные узлы.

Работа экспертной системы представляет собой путь по графу. Такой путь
состоит из последовательности однотипных шагов, на каждом из которых
пользователь должен решить, по какой дуге он пойдет из очередного узла.

Сформированный в ходе выполнения курсовой работы орграф решений
содержит 36 узлов. Например, такими как
«Таким же способом внутри вашей норы оказывается еще дюжина гномов...Вы задумываетесь о выборе.»,
или «Дни в крепости эльфов...А тем временем вы — единственный из отряда, кто еще способен изменить ситуацию — для себя или для отряда».

Для краткости выше часть текста скрыта многоточием.

На рисунке \ref{fig:full dag} представлен орграф решений, текст в узлах заменен идентификаторами.
Крупными блоками обозначены вершины фактор-графа, полученного стягиванием цепочек.

![Полный орграф решений. Цвета соответствуют рис. \ref{fig:condense} \label{fig:full dag}](img/course/full-dag.pdf)

Важно заметить, что в орграфе решений имеется одна входная вершина,
и каждое следующее состояние определяется однозначно текущим состоянием и символом на входе.
Таким образом это --- детерминированный конечный автомат.

# Особенности реализации

Экспертная система была реализована в среде разработки CLIPS.

CLIPS поддерживает эвристическую и процедурную парадигму представления
знаний. Для представления знаний в процедурной парадигме CLIPS
предоставляет такие механизмы, как глобальные переменные, функции и
родовые функции.

Правила в CLIPS служат для представления эвристик или так называемых
«эмпирических правил», которые определяют набор команд, выполняемых
при возникновении некоторой ситуации. Реализуется некоторый набор
правил, которые вместе работают над решением задачи. Правила состоят из
предпосылок и следствия.

Предпосылки называются ЕСЛИ-частью правила, левой частью правила или LHS
правила (left-hand side of rule). Следствие называется ТО-частью
правила, правой частью правила или RHS правила (right-hand side of
rule).[@chast2001]

Реализация данной экспертной системы активно использует
управляющие команды CLIPS, такие как if-then-else и while.

Для создания фактов в CLIPS предусмотрен специальный конструктор
`deftemplate`. Его использование приводит к появлению в текущей базе знаний системы
информации о _шаблоне факта_, с помощью которого в систему в дальнейшем можно будет
добавлять _факты_, соответствующие данному шаблону. Конструктор `deftemplate`
аналогичен оператору `struct` в языке программирования С.

Вот как оно используется:

```{.clp include=../Course/hobbit.clp snippet=deftemplate}
```
Шаблоны `question` и `answer` наполняются фактами в начале работы путем импорта из файла `hobbit.q.clp`:

```{.clp include=../Course/hobbit.clp snippet=load}
```

Для добавления новых правил в базу знаний CLIPS
предоставляет специальный конструктор `defrule`.[@chast2001]

```{.clp include=../Course/hobbit.clp snippet=ask-a-question}
```

С помощью команды `assert` при исполнении правила `QUESTIONS::ask-a-question` появляются факты, влияющие на работу правила.

CLIPS предоставляет не только средства абстракции данных, но и процедурные, например так определяется функция `ask-question`:

```{.clp include=../Course/hobbit.clp snippet=ask-question}
```

Двигаясь от начального узла орграфа, то есть от
блока «Как-то тихим утром вы, плотно подзакусив и покуривая трубку...», пользователь
переходит от блока к блоку с помощью выбора варианта вводом одного символа из перечня `abc`,
пока не дойдет до конечного блока.

От ответа пользователя зависит движение по орграфу. Узлы орграфа
заданы c помощью фактов в файле `hobbit.q.clp`. Вот пример первых двух фактов, которые определяют содержимое начального блока:

```{.clp include=../Course/hobbit.clp snippet=question-init}
```

# Результаты работы программы

На рис. \ref{fig:bad 1}-\ref{fig:good 5} представлены результаты работы программы.

После запуска программы выводится первый блок (начальная вершина орграфа).
Пользователь с помощью ответов `a/b/c` производит выбор и приходит к одной из концовок.
По завершению квеста программа завершается.

```{=tex}
\begin{figure}
  \centering
```
```plain
$ clips -f2 hobbit.clp

Хоббит: Путешествие

Как-то тихим утром вы, плотно подзакусив и покуривая трубку, стояли у двери своего обиталища, добродушно наблюдая за странно одетым стариком в дорожном плаще и остроконечной шляпе, сжимавшем в руке посох.

a: Вы здороваетесь и предлагаете старику отдохнуть.
>a  
— Спасибо за приглашение, но мне некогда заниматься пустяками. Я должен найти того, кто согласится отправиться со мной навстречу приключениям, — отзывается странник.

a: Вы отвечаете, что в здешних краях никто не согласится на такое
>a
Несмотря на ваш ответ, упрямый старик не желает уходить.

Он признается, что пришел в Шир исключительно за вами, чтобы приключение пошло вам на пользу, а также принесло некоторую выгоду.

a: — Извините! Мне что-то не хочется, спасибо, как-нибудь в другой раз. Всего хорошего! Пожалуйста, заходите ко мне на чашку чая в любой день! Скажем, завтра? Приходите завтра! До свиданья!
b: — Спасибо за предложение, но не думаю. Не знаю, почему вы так думаете, но я — Бэггинс, поэтому предпочту остаться здесь. Прощайте! Надеюсь, в другом месте вы найдете более безрассудного тупицу!
>b
Не все приключения заканчиваются счастливым концом. Но многие из них даже не начинаются. Сейчас вы спокойно можете жить в своей норе, пить чай в полуденной время, потягивать табак на крыльце, скрытые лиственной тенью. Однако, возможно, именно ваше присутствие могло бы что-то изменить в грядущих событиях. Возможно, стоило быть менее любезным с незнакомцем в солнечный летний денек.

a: Вперед
>a
Одинокая гора все так же останется в лапах дракона, спящего на кучах золота, добытого трудом предков Торина в шахтах и рудниках. Самый большой дракон из ныне живущих вскоре окажется побеспокоен Некромантом, и кто знает, смогут ли они договориться...

a: Вперед
>a
Кольцо, ранее принадлежащее величайшему врагу Свободных народов Средиземья, вскоре должно будет вернуться своему хозяину. И вот тогда спокойной ленности забывших о войне земель придет конец.

Игра окончена.
```
```{=tex}
\caption{Прохождение с плохой концовкой: Бильбо отказал Гендальфу и не спас народ Средиземья.}
  \label{fig:bad 1}
\end{figure}
```

```{=tex}
\begin{figure}
  \centering
```
```clp
$ clips -f2 hobbit.clp

Хоббит: Путешествие

Как-то тихим утром вы, плотно подзакусив и покуривая трубку, стояли у двери своего обиталища, добродушно наблюдая за странно одетым стариком в дорожном плаще и остроконечной шляпе, сжимавшем в руке посох.

a: Вы здороваетесь и предлагаете старику отдохнуть.
>a
— Спасибо за приглашение, но мне некогда заниматься пустяками. Я должен найти того, кто согласится отправиться со мной навстречу приключениям, — отзывается странник.

a: Вы отвечаете, что в здешних краях никто не согласится на такое
>a
Несмотря на ваш ответ, упрямый старик не желает уходить.

Он признается, что пришел в Шир исключительно за вами, чтобы приключение пошло вам на пользу, а также принесло некоторую выгоду.

a: — Извините! Мне что-то не хочется, спасибо, как-нибудь в другой раз. Всего хорошего! Пожалуйста, заходите ко мне на чашку чая в любой день! Скажем, завтра? Приходите завтра! До свиданья!
b: — Спасибо за предложение, но не думаю. Не знаю, почему вы так думаете, но я — Бэггинс, поэтому предпочту остаться здесь. Прощайте! Надеюсь, в другом месте вы найдете более безрассудного тупицу!
>a
Когда на следующий день вы собираетесь выпить чай, дверной колокольчик оповещает о посетителе. Но это не Гэндальф, а гном, который сразу шмыгнул внутрь, как будто только его и ждали.

a: Вы решаете проявить радушие и приглашаете его к столу.
>a
Таким же способом внутри вашей норы оказывается еще дюжина гномов с наконец-таки присоединившимся волшебником.

Гномы открывают вам историю о их потерянном доме, отобранном драконом наследии, богатстве и чести. Гэндальф предлагает ваши услуги в качестве взломщика, который мог бы сопровождать их в приключении, целью которого и будет исправление несправедливого захватничества. Вы нужны им, чтобы проникнуть в спрятанный в горе потайной ход.

Возглавляющий отряд гномов нелестно отзывается о вашем характере, что вас задевает. Однако с подачи и рекомендации мага он оставляет вам договор, обещая четырнадцатую часть добычи и покрытие похоронных и путевых издержек.
```
```{=tex}
\caption{Прохождение с хорошей концовкой. часть 1}
  \label{fig:good 1}
\end{figure}
```
```{=tex}
\begin{figure}
  \centering
```
```clp
Вы задумываетесь о выборе.

a: Вы понимаете, что гномы считают вас никуда не годным. Но вы намерены доказать, на что способны.
b: При словах о том, что вы или гномы «могут не вернуться назад», вы почувствовали, что к горлу подкатывается крик. Тут уж никакими компенсациями и деньгами не изменить перспективу.
>a
Вы выдвигаетесь в путь, держите его несколько дней. В один из привалов обнаруживается, что пропали ваши пони, поэтому вас, как взломщика, отправляют на разведку. 

Пони оказываются вероятным ужином озлобленных скудностью рациона троллей.

a: В попытке не спасти транспорт, так обчистить троллей, — как истинный взломщик, вы пытаетесь украсть их кошельки
>a
Ваша попытка оканчивается неудачей, а появившихся на выручку товарищей поджидает та же участь, что и вас временем ранее, — теперь весь отряд оказывается схвачен, связан и обездвижен огромными великанами, жаждущими приготовить из вас замечательный ужин.

У вас не так много вариантов для дальнейших действий.

a: Вы начинаете утверждать, что без должной обработки гномы окажутся невкусными и грозят несварением.
b: Вы решаете воспользоваться своими навыками и попытаться выскользнуть из мешка, чтобы незаметно помочь остальным.
>a
Гэндальф, искусно подделывая голоса троллей, вступает в их разговор и тянет время до рассвета. С первыми лучами солнца тролли превращаются в камень, и отряд получает возможность продолжить путешествие.

a: Вперед
>a
При переходе через Туманные горы на пути к цели отряд по неосторожности попадает в плен к гоблинам, которые отводят вас в подземелья, но Гэндальф и здесь вновь помогает спастись, вступая в сражение. Однако в хитросплетении пещер и гуще сражений вы отбиваетесь от группы и теряетесь, но находите золотое кольцо.

a: Как вор и взломщик, вы не можете отказать себе в желании его забрать
>a
Там же вы встречаете и Голлума — скользкое существо, живущее у подземного озера.

Он предлагает сыграть с ним в загадки, чтобы выбраться из пещер, а в случае проигрыша угрожает расправиться с вами. У вас нет выбора — и...

a: вы внимаете Голлуму
>a
Первая загадка такова:

Не увидать ее корней,
Вершина выше тополей,
Все вверх и вверх она идет,
Но не растет.

a: секвойя
b: гора
c: многоэтажка
>b
```
```{=tex}
\caption{Прохождение с хорошей концовкой. часть 2}
  \label{fig:good 2}
\end{figure}
```

```{=tex}
\begin{figure}
  \centering
```
```clp
Затем он задал вторую загадку:

Без голоса кричит,
Без зубов кусает,
Без крыльев летит,
Без горла завывает.

a: левиафан
b: холод
c: ветер
>c
На сей раз он загадал загадку покаверзнее:

Ее не видать
И в руки не взять,
Царит над всем,
Не пахнем ничем.
Встает во весь рост
На небе меж звезд.
Все начинает
И все кончает.

a: расстояние
b: темнота
c: размерность
>b
— Ты справился с тремя загадками. Что ты ответишь на эту?

Уничтожает все кругом:
Цветы, зверей, высокий дом,
Сжует железо, сталь сожрет
И скалы в порошок сотрет,
Мощь городов, власть королей
Его могущества слабей.

a: упокоение
b: время
c: эрозия
>b
Вам кажется, что все идет хорошо, но Голлум подозревает вас в краже своего волшебного кольца, способного делать владельца невидимым, и поэтому нападает на вас.

Случайно, надев кольцо на палец, вы понимаете, что за способность оно в силах даровать.

a: Так, следуя за Голлумом, вы и находите выход из пещер.
>a
А вскоре и своих спутников. Но вас снова настигают враги — на этот раз к отряду гоблинов присоединяются варги, и только вмешательство орлов, которых успевает призвать ваш крайне полезный и результативный волшебник, спасает вам жизни.

В дальнейшем вашем маршруте, который оказывается Лихолесьем, Гэндальф снова покидает вас, отправившись по неотложным делам. Лес кажется бесконечным, ему нет конца. Он темен и болен.

a: Вас и ваших спутников охватывает уныние
>a
```
```{=tex}
\caption{Прохождение с хорошей концовкой. часть 3}
  \label{fig:good 3}
\end{figure}\newpage
```
```{=tex}
\begin{figure}
  \centering
```
```clp
Именно оно заставляет их покинуть тропу, с которой запретил сходить маг, и оказаться посему в лапах гигантских пауков. Вы знаете, что можете помочь остальным, но для этого нужно воспользоваться кольцом, о котором вы мало что знаете, но которое уже вызывает в вас паническую тревогу. И вас все еще могут учуять, раз не могут увидеть!

Однако время не терпит, и выбор должен быть сделан.

a: Вы решаете, что воспользоваться артефактом — единственный возможный вариант
b: Кольцо принадлежало ранее существу, которое сошло с ума — вы предпочли бы избежать такого исхода для себя
>a
Однако не все гномы оказались в паучьей ловушке. В это время их предводитель, Торин, был схвачен и заточен эльфами. Отправившись его вызволять, они, обессиленные долгими скитаниями по гиблому лесу и схваткой, также оказываются схваченными. Время тянется невыносимо уныло, пока гномов допрашивают и разводят по тюремным камерам.

a: Вы прячетесь, не смея ни на минуту снять кольцо, почти не смыкая глаз, даже когда удается забиться в самый дальний, темный уголок.
>a
Дни в крепости эльфов, кажется, просто тянут время перед неминуемым крахом вашего предприятия. На этот раз Гэндальф не успеет прийти к ним на помощь.

А тем временем вы — единственный из отряда, кто еще способен изменить ситуацию — для себя или для отряда.

a: И снова вы думаете воспользоваться кольцом
b: Вы не успеваете ничего сделать, попавшись страже эльфийского замка.
c: Возможно, самое время отступить и вернуться домой. Хотя бы живым.
>a
После успешного побега из эльфийского заключения, ваш отряд наконец почти у цели — вы прибываете в Озёрный город, минуете его и достигаете Одинокой Горы.

Теперь вы готовы справиться от своей первоначальной задачей, предписанной контрактом, — по потайному пути вы двигаетесь в зал, где ныне дремлет дракон. Вы двигаетесь неслышно, невидимы его глазу благодаря кольцу.

a: Но вы забыли, что у драконов поразительный нюх.
>a
— Ага, пожаловал, вор! Я тебя чую, я слышу твое дыхание. 

На этот раз вы хотите...

a: попытаться выиграть время, льстя дракону в надежде, что найдете выход
b: попытаться бежать
c: поговорить о произошедшем
>a
— Я убиваю, когда захочу, никто не дерзает сопротивляться. Всех воинов прошлого я уничтожил, а нынче такие не рождаются, — злорадно торжествовал дракон. — Моя броня вдесятеро крепче щитов, мои зубы — мечи, когти — копья, удар хвоста подобен удару молнии, крылья несут с быстротой урагана, мое дыхание — смерть!

a: Вы продолжаете наблюдать за драконом
>a
Вы узнаёте о слабом месте дракона — ведь слушая ваши льстивые речи и отвечая им, он случайно продемонстрировал отсутствующую чешую на его туловище. Однако, сумев скрыться, вы разозлили дракона, поэтому он решает отомстить жителям Озёрного города за помощь гномам в походе на гору, нападает на поселение и сжигает его.
```
```{=tex}
\caption{Прохождение с хорошей концовкой. часть 4}
  \label{fig:good 4}
\end{figure}
```
```{=tex}
\begin{figure}
  \centering
```
```clp
Дрозд, который услышал ваш рассказ об уязвимом месте дракона, сообщает об этом лучнику Барду, и тот убивает дракона.

a: Вперед
>a
Теперь радость победы омрачнена уже армиями лесных эльфов и жителей Озёрного города. Бард, возглавляющий людей, требует от Торина поделиться с ним частью сокровищ, как и король лесных эльфов. Торин отказывается выполнять претезания на вновь обретенные богатства — он опьянен ими, перебирает их часами напролет, теряя рассудок, подчиненный блеском зачарованного драконом золота.

a: Вперед
>a
Он в поисках среди драгоценностей. Аркенстон — драгоценный камень королевской династии гномов, представляющий для Торина наибольшую ценность среди всех сокровищ. Вы до сих пор не в силах признаться, что нашли его, потому что опасаетесь за рассудок гнома, уже продемонстрировавшего ожесточенность в переговорах с осаждающими. 
Дело приобретает новый виток трудностей.

Вы решаете...

a: вынудить гномов вести переговоры и решить конфликт мирным путём
b: отдать камень Торину — потому что вы честный хоббит, а он его законный владелец
c: оставить это все — ваша роль здесь окончена, вы выполнили контракт, поэтому хотели бы взять причитающуюся долю и вернуться домой
>a
Вы передаёте предводителям армий людей и эльфов в качестве залога найденный Аркенстон, поэтому Торин обвиняет вас в предательстве и прогоняет. В это же время к Одинокой Горе подходит войско гномов из Железных Холмов под руководством родственника Торина. Враждующие стороны едва не начинают битву, однако у Одинокой Горы неожиданно появляются армии гоблинов и варгов. В этих обстоятельствах гномы, эльфы и люди объединяются против общих врагов.

a: Начинается сражение
>a
Вы передаёте предводителям армий людей и эльфов в качестве залога найденный Аркенстон, поэтому Торин обвиняет вас в предательстве и прогоняет. В это же время к Одинокой Горе подходит войско гномов из Железных Холмов под руководством родственника Торина. Враждующие стороны едва не начинают битву, однако у Одинокой Горы неожиданно появляются армии гоблинов и варгов. В этих обстоятельствах гномы, эльфы и люди объединяются против общих врагов.

a: Начинается сражение
>a
Победа достигнута, но дорогой ценой — погибают многие воины, в том числе Торин, перед самой смертью успевший понять и простить ваш поступок. Вы наконец можете отправиться домой, чтобы вернуться к спокойной жизни и вести захватывающие мемуары.

Игра окончена.
```
```{=tex}
\caption{Прохождение с хорошей концовкой. часть 5}
  \label{fig:good 5}
\end{figure}
```

\newpage\refstepcounter{section}
# Заключение {-}

В результате курсовой работы была изучена среда разработки CLIPS и
реализована продукционная модель экспертной системы
«Текстовый квест по мотивам повести „Хоббит, или Туда и обратно“ Дж. Р. Р. Толкина» в среде CLIPS.

Основные преимущества инструментального средства CLIPS:

-   данное программное обеспечение свободно распространяется;
-   кроссплатформенность;
-   наличие полной открытой документации;
-   наличие программного интерфейса (позволяет встраивать его в программные продукты, написанные на языке C, Java и др.);
-   доступны средства абстракции правил, фактов и процедур.

Однако CLIPS имеет скудные возможности полиморфизма, наследования и вложенности фактов.

Реализованный программно орграф решений имеет 36 узлов, из них: листья --- концовки --- два узла, начальный узел --- один.
Максимальная длина пути --- 27 переходов (дуг).

Преимущества использования экспертных систем по сравнению с
использованием опытных специалистов состоит в следующем:

-   устойчивость и воспроизводимость результатов;
-   низкая стоимость разработки и поддержки.

Моделью представления знания реализованной системы является
продукционная модель.

*Достоинства продукционной модели:*

-   внутренняя работа модели может быть интерпретирована человеком, в отличии от некоторых моделей машинного обучения.

-   поиск в ориентированном графе решений --- вычислительно несложная задача. Сложность процедуры выбора --- $𝒪(n)$, где $n$ --- количество вводов.

-   теория продукционных моделей хорошо разработана.

*Недостатки продукционной модели:*

-   не учитывает вероятностный характер некоторых знаний (в таком случае могут, например применяться модели байесовского вывода)

-   требует однозначности в представлении знаний: в такой модели утверждения (факты) могут быть либо истинными, либо ложными
    (в этом случае можно применять модели нечеткой логики).

Реализованная программа легко масштабируема, реализована общая схема переходов между текстовыми
блоками путем выбора из ограниченного набора символов. Система позволяет реализовать и другие текстовые квесты путем подмены базы знаний:
блоки связаны с ответами по идентификатору, как в реляционной БД.

Экспертная система представлена ациклическим орграфом, что делает поиск решения
быстрым. Построенная система в полной мере решает художественную задачу,
позволяя различными путями приходить к финалам.

Возможным следующим шагом в развитии данной программы могло быть преобразование модели в семантическую сеть.
Для этого можно использовать не только отношение «следует за», но и другие.
Примером текстового квеста, который может быть реализован таким образом --- классическая игра Zork.

\newpage\refstepcounter{section}
# Список использованных источников {-}

::: {#refs}
:::

<!-- 
```{.clp include=../Course/hobbit.clp snippet=\1}
```
// start snippet \1
// end snippet \1 -->